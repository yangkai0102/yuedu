(function(r){r.fn.qrcode=function(h){var s;function u(a){this.mode=s;this.data=a}function o(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function q(a,c){if(void 0==a.length)throw Error(a.length+"/"+c);for(var d=0;d<a.length&&0==a[d];)d++;this.num=Array(a.length-d+c);for(var b=0;b<a.length-d;b++)this.num[b]=a[b+d]}function p(a,c){this.totalCount=a;this.dataCount=c}function t(){this.buffer=[];this.length=0}u.prototype={getLength:function(){return this.data.length},write:function(a){for(var c=0;c<this.data.length;c++)a.put(this.data.charCodeAt(c),8)}};o.prototype={addData:function(a){this.dataList.push(new u(a));this.dataCache=null},isDark:function(a,c){if(0>a||this.moduleCount<=a||0>c||this.moduleCount<=c)throw Error(a+","+c);return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1,a=1;40>a;a++){for(var c=p.getRSBlocks(a,this.errorCorrectLevel),d=new t,b=0,e=0;e<c.length;e++)b+=c[e].dataCount;for(e=0;e<this.dataList.length;e++)c=this.dataList[e],d.put(c.mode,4),d.put(c.getLength(),j.getLengthInBits(c.mode,a)),c.write(d);if(d.getLengthInBits()<=8*b)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++)this.modules[d][b]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-
7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);7<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=o.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,c){for(var d=-1;7>=d;d++)if(!(-1>=a+d||this.moduleCount<=a+d))for(var b=-1;7>=b;b++)-1>=c+b||this.moduleCount<=c+b||(this.modules[a+d][c+b]=0<=d&&6>=d&&(0==b||6==b)||0<=b&&6>=b&&(0==d||6==d)||2<=d&&4>=d&&2<=b&&4>=b?!0:!1)},getBestMaskPattern:function(){for(var a=0,c=0,d=0;8>d;d++){this.makeImpl(!0,d);var b=j.getLostPoint(this);if(0==d||a>b)a=b,c=d}return c},createMovieClip:function(a,c,d){a=a.createEmptyMovieClip(c,d);this.make();for(c=0;c<this.modules.length;c++)for(var d=1*c,b=0;b<this.modules[c].length;b++){var e=1*b;this.modules[c][b]&&(a.beginFill(0,100),a.moveTo(e,d),a.lineTo(e+1,d),a.lineTo(e+1,d+1),a.lineTo(e,d+1),a.endFill())}return a},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),c=0;c<a.length;c++)for(var d=0;d<a.length;d++){var b=a[c],e=a[d];if(null==this.modules[b][e])for(var f=-2;2>=f;f++)for(var i=-2;2>=i;i++)this.modules[b+f][e+i]=-2==f||2==f||-2==i||2==i||0==f&&0==i?!0:!1}},setupTypeNumber:function(a){for(var c=j.getBCHTypeNumber(this.typeNumber),d=0;18>d;d++){var b=!a&&1==(c>>d&1);this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=b}for(d=0;18>d;d++)b=!a&&1==(c>>d&1),this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=b},setupTypeInfo:function(a,c){for(var d=j.getBCHTypeInfo(this.errorCorrectLevel<<3|c),b=0;15>b;b++){var e=!a&&1==(d>>b&1);6>b?this.modules[b][8]=e:8>b?this.modules[b+1][8]=e:this.modules[this.moduleCount-15+b][8]=e}for(b=0;15>b;b++)e=!a&&1==(d>>b&1),8>b?this.modules[8][this.moduleCount-
b-1]=e:9>b?this.modules[8][15-b-1+1]=e:this.modules[8][15-b-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,c){for(var d=-1,b=this.moduleCount-1,e=7,f=0,i=this.moduleCount-1;0<i;i-=2)for(6==i&&i--;;){for(var g=0;2>g;g++)if(null==this.modules[b][i-g]){var n=!1;f<a.length&&(n=1==(a[f]>>>e&1));j.getMask(c,b,i-g)&&(n=!n);this.modules[b][i-g]=n;e--;-1==e&&(f++,e=7)}b+=d;if(0>b||this.moduleCount<=b){b-=d;d=-d;break}}}};o.PAD0=236;o.PAD1=17;o.createData=function(a,c,d){for(var c=p.getRSBlocks(a,c),b=new t,e=0;e<d.length;e++){var f=d[e];b.put(f.mode,4);b.put(f.getLength(),j.getLengthInBits(f.mode,a));f.write(b)}for(e=a=0;e<c.length;e++)a+=c[e].dataCount;if(b.getLengthInBits()>8*a)throw Error("code length overflow. ("+b.getLengthInBits()+">"+8*a+")");for(b.getLengthInBits()+4<=8*a&&b.put(0,4);0!=b.getLengthInBits()%8;)b.putBit(!1);for(;!(b.getLengthInBits()>=8*a);){b.put(o.PAD0,8);if(b.getLengthInBits()>=8*a)break;b.put(o.PAD1,8)}return o.createBytes(b,c)};o.createBytes=function(a,c){for(var d=0,b=0,e=0,f=Array(c.length),i=Array(c.length),g=0;g<c.length;g++){var n=c[g].dataCount,h=c[g].totalCount-n,b=Math.max(b,n),e=Math.max(e,h);f[g]=Array(n);for(var k=0;k<f[g].length;k++)f[g][k]=255&a.buffer[k+d];d+=n;k=j.getErrorCorrectPolynomial(h);n=(new q(f[g],k.getLength()-1)).mod(k);i[g]=Array(k.getLength()-1);for(k=0;k<i[g].length;k++)h=k+n.getLength()-i[g].length,i[g][k]=0<=h?n.get(h):0}for(k=g=0;k<c.length;k++)g+=c[k].totalCount;d=Array(g);for(k=n=0;k<b;k++)for(g=0;g<c.length;g++)k<f[g].length&&(d[n++]=f[g][k]);for(k=0;k<e;k++)for(g=0;g<c.length;g++)k<i[g].length&&(d[n++]=i[g][k]);return d};s=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var c=a<<10;0<=j.getBCHDigit(c)-j.getBCHDigit(j.G15);)c^=j.G15<<j.getBCHDigit(c)-j.getBCHDigit(j.G15);return(a<<10|c)^j.G15_MASK},getBCHTypeNumber:function(a){for(var c=a<<12;0<=j.getBCHDigit(c)-
j.getBCHDigit(j.G18);)c^=j.G18<<j.getBCHDigit(c)-j.getBCHDigit(j.G18);return a<<12|c},getBCHDigit:function(a){for(var c=0;0!=a;)c++,a>>>=1;return c},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,c,d){switch(a){case 0:return 0==(c+d)%2;case 1:return 0==c%2;case 2:return 0==d%3;case 3:return 0==(c+d)%3;case 4:return 0==(Math.floor(c/2)+Math.floor(d/3))%2;case 5:return 0==c*d%2+c*d%3;case 6:return 0==(c*d%2+c*d%3)%2;case 7:return 0==(c*d%3+(c+d)%2)%2;default:throw Error("bad maskPattern:"+
a);}},getErrorCorrectPolynomial:function(a){for(var c=new q([1],0),d=0;d<a;d++)c=c.multiply(new q([1,l.gexp(d)],0));return c},getLengthInBits:function(a,c){if(1<=c&&10>c)switch(a){case 1:return 10;case 2:return 9;case s:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>c)switch(a){case 1:return 12;case 2:return 11;case s:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>c)switch(a){case 1:return 14;case 2:return 13;case s:return 16;case 8:return 12;default:throw Error("mode:"+
a);}else throw Error("type:"+c);},getLostPoint:function(a){for(var c=a.getModuleCount(),d=0,b=0;b<c;b++)for(var e=0;e<c;e++){for(var f=0,i=a.isDark(b,e),g=-1;1>=g;g++)if(!(0>b+g||c<=b+g))for(var h=-1;1>=h;h++)0>e+h||c<=e+h||0==g&&0==h||i==a.isDark(b+g,e+h)&&f++;5<f&&(d+=3+f-5)}for(b=0;b<c-1;b++)for(e=0;e<c-1;e++)if(f=0,a.isDark(b,e)&&f++,a.isDark(b+1,e)&&f++,a.isDark(b,e+1)&&f++,a.isDark(b+1,e+1)&&f++,0==f||4==f)d+=3;for(b=0;b<c;b++)for(e=0;e<c-6;e++)a.isDark(b,e)&&!a.isDark(b,e+1)&&a.isDark(b,e+
2)&&a.isDark(b,e+3)&&a.isDark(b,e+4)&&!a.isDark(b,e+5)&&a.isDark(b,e+6)&&(d+=40);for(e=0;e<c;e++)for(b=0;b<c-6;b++)a.isDark(b,e)&&!a.isDark(b+1,e)&&a.isDark(b+2,e)&&a.isDark(b+3,e)&&a.isDark(b+4,e)&&!a.isDark(b+5,e)&&a.isDark(b+6,e)&&(d+=40);for(e=f=0;e<c;e++)for(b=0;b<c;b++)a.isDark(b,e)&&f++;a=Math.abs(100*f/c/c-50)/5;return d+10*a}},l={glog:function(a){if(1>a)throw Error("glog("+a+")");return l.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return l.EXP_TABLE[a]},EXP_TABLE:Array(256),LOG_TABLE:Array(256)},m=0;8>m;m++)l.EXP_TABLE[m]=1<<m;for(m=8;256>m;m++)l.EXP_TABLE[m]=l.EXP_TABLE[m-4]^l.EXP_TABLE[m-5]^l.EXP_TABLE[m-6]^l.EXP_TABLE[m-8];for(m=0;255>m;m++)l.LOG_TABLE[l.EXP_TABLE[m]]=m;q.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var c=Array(this.getLength()+a.getLength()-1),d=0;d<this.getLength();d++)for(var b=0;b<a.getLength();b++)c[d+b]^=l.gexp(l.glog(this.get(d))+l.glog(a.get(b)));return new q(c,0)},mod:function(a){if(0>this.getLength()-a.getLength())return this;for(var c=l.glog(this.get(0))-l.glog(a.get(0)),d=Array(this.getLength()),b=0;b<this.getLength();b++)d[b]=this.get(b);for(b=0;b<a.getLength();b++)d[b]^=l.gexp(l.glog(a.get(b))+c);return(new q(d,0)).mod(a)}};p.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];p.getRSBlocks=function(a,c){var d=p.getRsBlockTable(a,c);if(void 0==d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var b=d.length/3,e=[],f=0;f<b;f++)for(var h=d[3*f+0],g=d[3*f+1],j=d[3*f+2],l=0;l<h;l++)e.push(new p(g,j));return e};p.getRsBlockTable=function(a,c){switch(c){case 1:return p.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return p.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return p.RS_BLOCK_TABLE[4*(a-1)+2];case 2:return p.RS_BLOCK_TABLE[4*(a-1)+3]}};t.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,c){for(var d=0;d<c;d++)this.putBit(1==(a>>>c-d-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var c=Math.floor(this.length/8);this.buffer.length<=c&&this.buffer.push(0);a&&(this.buffer[c]|=128>>>this.length%8);this.length++}};"string"===typeof h&&(h={text:h});h=r.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,correctLevel:2,background:"#ffffff",foreground:"#000000"},h);return this.each(function(){var a;if("canvas"==h.render){a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();var c=document.createElement("canvas");c.width=h.width;c.height=h.height;for(var d=c.getContext("2d"),b=h.width/a.getModuleCount(),e=h.height/a.getModuleCount(),f=0;f<a.getModuleCount();f++)for(var i=0;i<a.getModuleCount();i++){d.fillStyle=a.isDark(f,i)?h.foreground:h.background;var g=Math.ceil((i+1)*b)-Math.floor(i*b),j=Math.ceil((f+1)*b)-Math.floor(f*b);d.fillRect(Math.round(i*b),Math.round(f*e),g,j)}}else{a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();c=r("<table></table>").css("width",h.width+"px").css("height",h.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",h.background);d=h.width/a.getModuleCount();b=h.height/a.getModuleCount();for(e=0;e<a.getModuleCount();e++){f=r("<tr></tr>").css("height",b+"px").appendTo(c);for(i=0;i<a.getModuleCount();i++)r("<td></td>").css("width",d+"px").css("background-color",a.isDark(e,i)?h.foreground:h.background).appendTo(f)}}a=c;jQuery(a).appendTo(this)})}})(jQuery);;(function($){var em=[{'id':1,'phrase':'[微笑]','url':'1.gif'},{'id':2,'phrase':'[撇嘴]','url':'2.gif'},{'id':3,'phrase':'[色]','url':'3.gif'},{'id':4,'phrase':'[发呆]','url':'4.gif'},{'id':5,'phrase':'[得意]','url':'5.gif'},{'id':6,'phrase':'[流泪]','url':'6.gif'},{'id':7,'phrase':'[害羞]','url':'7.gif'},{'id':8,'phrase':'[闭嘴]','url':'8.gif'},{'id':9,'phrase':'[睡]','url':'9.gif'},{'id':10,'phrase':'[大哭]','url':'10.gif'},{'id':11,'phrase':'[尴尬]','url':'11.gif'},{'id':12,'phrase':'[发怒]','url':'12.gif'},{'id':13,'phrase':'[调皮]','url':'13.gif'},{'id':14,'phrase':'[呲牙]','url':'14.gif'},{'id':15,'phrase':'[惊讶]','url':'15.gif'},{'id':16,'phrase':'[难过]','url':'16.gif'},{'id':17,'phrase':'[酷]','url':'17.gif'},{'id':18,'phrase':'[冷汗]','url':'18.gif'},{'id':19,'phrase':'[抓狂]','url':'19.gif'},{'id':20,'phrase':'[吐]','url':'20.gif'},{'id':21,'phrase':'[偷笑]','url':'21.gif'},{'id':22,'phrase':'[可爱]','url':'22.gif'},{'id':23,'phrase':'[白眼]','url':'23.gif'},{'id':24,'phrase':'[傲慢]','url':'24.gif'},{'id':25,'phrase':'[饥饿]','url':'25.gif'},{'id':26,'phrase':'[困]','url':'26.gif'},{'id':27,'phrase':'[惊恐]','url':'27.gif'},{'id':28,'phrase':'[流汗]','url':'28.gif'},{'id':29,'phrase':'[憨笑]','url':'29.gif'},{'id':30,'phrase':'[大兵]','url':'30.gif'},{'id':31,'phrase':'[奋斗]','url':'31.gif'},{'id':32,'phrase':'[咒骂]','url':'32.gif'},{'id':33,'phrase':'[疑问]','url':'33.gif'},{'id':34,'phrase':'[嘘]','url':'34.gif'},{'id':35,'phrase':'[晕]','url':'35.gif'},{'id':36,'phrase':'[折磨]','url':'36.gif'},{'id':37,'phrase':'[衰]','url':'37.gif'},{'id':38,'phrase':'[骷髅]','url':'38.gif'},{'id':39,'phrase':'[敲打]','url':'39.gif'},{'id':40,'phrase':'[再见]','url':'40.gif'},{'id':41,'phrase':'[擦汗]','url':'41.gif'},{'id':42,'phrase':'[抠鼻]','url':'42.gif'},{'id':43,'phrase':'[鼓掌]','url':'43.gif'},{'id':44,'phrase':'[糗大了]','url':'44.gif'},{'id':45,'phrase':'[坏笑]','url':'45.gif'},{'id':46,'phrase':'[左哼哼]','url':'46.gif'},{'id':47,'phrase':'[右哼哼]','url':'47.gif'},{'id':48,'phrase':'[哈欠]','url':'48.gif'},{'id':49,'phrase':'[鄙视]','url':'49.gif'},{'id':50,'phrase':'[委屈]','url':'50.gif'},{'id':51,'phrase':'[快哭了]','url':'51.gif'},{'id':52,'phrase':'[阴险]','url':'52.gif'},{'id':53,'phrase':'[亲亲]','url':'53.gif'},{'id':54,'phrase':'[吓]','url':'54.gif'},{'id':55,'phrase':'[可怜]','url':'55.gif'},{'id':56,'phrase':'[菜刀]','url':'56.gif'},{'id':57,'phrase':'[西瓜]','url':'57.gif'},{'id':58,'phrase':'[啤酒]','url':'58.gif'},{'id':59,'phrase':'[篮球]','url':'59.gif'},{'id':60,'phrase':'[乒乓]','url':'60.gif'},{'id':61,'phrase':'[咖啡]','url':'61.gif'},{'id':62,'phrase':'[饭]','url':'62.gif'},{'id':63,'phrase':'[猪头]','url':'63.gif'},{'id':64,'phrase':'[玫瑰]','url':'64.gif'},{'id':65,'phrase':'[凋谢]','url':'65.gif'},{'id':66,'phrase':'[示爱]','url':'66.gif'},{'id':67,'phrase':'[爱心]','url':'67.gif'},{'id':68,'phrase':'[心碎]','url':'68.gif'},{'id':69,'phrase':'[蛋糕]','url':'69.gif'},{'id':70,'phrase':'[闪电]','url':'70.gif'},{'id':71,'phrase':'[炸弹]','url':'71.gif'},{'id':72,'phrase':'[刀]','url':'72.gif'},{'id':73,'phrase':'[足球]','url':'73.gif'},{'id':74,'phrase':'[瓢虫]','url':'74.gif'},{'id':75,'phrase':'[便便]','url':'75.gif'},{'id':76,'phrase':'[月亮]','url':'76.gif'},{'id':77,'phrase':'[太阳]','url':'77.gif'},{'id':78,'phrase':'[礼物]','url':'78.gif'},{'id':79,'phrase':'[拥抱]','url':'79.gif'},{'id':80,'phrase':'[强]','url':'80.gif'},{'id':81,'phrase':'[弱]','url':'81.gif'},{'id':82,'phrase':'[握手]','url':'82.gif'},{'id':83,'phrase':'[胜利]','url':'83.gif'},{'id':84,'phrase':'[抱拳]','url':'84.gif'},{'id':85,'phrase':'[勾引]','url':'85.gif'},{'id':86,'phrase':'[拳头]','url':'86.gif'},{'id':87,'phrase':'[差劲]','url':'87.gif'},{'id':88,'phrase':'[爱你]','url':'88.gif'},{'id':89,'phrase':'[NO]','url':'89.gif'},{'id':90,'phrase':'[OK]','url':'90.gif'},{'id':91,'phrase':'[爱情]','url':'91.gif'},{'id':92,'phrase':'[飞吻]','url':'92.gif'},{'id':93,'phrase':'[跳跳]','url':'93.gif'},{'id':94,'phrase':'[发抖]','url':'94.gif'},{'id':95,'phrase':'[怄火]','url':'95.gif'},{'id':96,'phrase':'[转圈]','url':'96.gif'},{'id':97,'phrase':'[磕头]','url':'97.gif'},{'id':98,'phrase':'[回头]','url':'98.gif'},{'id':99,'phrase':'[跳绳]','url':'99.gif'},{'id':100,'phrase':'[挥手]','url':'100.gif'},{'id':101,'phrase':'[激动]','url':'101.gif'},{'id':102,'phrase':'[街舞]','url':'102.gif'},{'id':103,'phrase':'[献吻]','url':'103.gif'},{'id':104,'phrase':'[左太极]','url':'104.gif'},{'id':105,'phrase':'[右太极]','url':'105.gif'}];function setCursorPosition(ctrl,pos){if(ctrl.setSelectionRange){ctrl.focus();ctrl.setSelectionRange(pos,pos);}else if(ctrl.createTextRange){var range=ctrl.createTextRange();range.collapse(true);range.moveEnd('character',pos);range.moveStart('character',pos);range.select();}}
function getPositionForTextArea(obj)
{var Sel=document.selection.createRange();var Sel2=Sel.duplicate();Sel2.moveToElementText(obj);var CaretPos=-1;while(Sel2.inRange(Sel)){Sel2.moveStart('character');CaretPos++;}
return CaretPos;}
$.fn.extend({jqfaceedit:function(options){var defaults={txtAreaObj:'',containerObj:'',textareaid:'msg',popName:'',emotions:em,top:0,left:0,faceImgPath:''};options=$.extend(defaults,options);var cpos=0;var textareaid=options.textareaid;return this.each(function(){var Obj=$(this);var container=options.containerObj;if(document.selection){options.txtAreaObj.bind("click keyup",function(e){e.stopPropagation();cpos=getPositionForTextArea(document.getElementById(textareaid)?document.getElementById(textareaid):window.frames[options.popName].document.getElementById(textareaid));});}
$(Obj).bind("click",function(e){e.stopPropagation();var faceHtml='<div id="face">';faceHtml+='<div id="texttb"><a class="f_close" title="关闭" href="javascript:void(0);"></a></div>';faceHtml+='<div id="facebox">';faceHtml+='<div id="face_detail" class="facebox cf"><dl>';for(i=0;i<options.emotions.length;i++){faceHtml+='<dd text='+options.emotions[i].phrase+' type='+i+'><img title='+options.emotions[i].phrase+' src="'+options.faceImgPath+'/emotions/'+options.emotions[i].url+'"  style="cursor:pointer;"   /></dd>';}
faceHtml+='</dl></div>';faceHtml+='</div><div class="arrow_f arrow_t"></div></div>';container.find('#face').remove();container.append(faceHtml);container.find("#face_detail dl > dd").bind("click",function(e){var txt=$(this).attr("text");var faceText=txt;var tclen=options.txtAreaObj.val().length;var tc=document.getElementById(textareaid);if(options.popName){tc=window.frames[options.popName].document.getElementById(textareaid);}
var pos=0;if(typeof document.selection!="undefined"){options.txtAreaObj.focus();setCursorPosition(tc,cpos);document.selection.createRange().text=faceText;pos=getPositionForTextArea(tc);}else{pos=tc.selectionStart+faceText.length;options.txtAreaObj.val(options.txtAreaObj.val().substr(0,tc.selectionStart)+faceText+options.txtAreaObj.val().substring(tc.selectionStart,tclen));}
cpos=pos;setCursorPosition(tc,pos);});container.find(".f_close").bind("click",function(){container.find("#face").remove();});$('body').bind("click",function(e){e.stopPropagation();container.find('#face').remove();$(this).unbind('click');});if(options.popName!=''){$(window.frames[options.popName].document).find('body').bind("click",function(e){e.stopPropagation();container.find('#face').remove();});}
container.find('#face').bind("click",function(e){e.stopPropagation();});container.find("#face").show();});});},emotionsToHtml:function(){var imgPath=CS.config.env.imgUrl;return this.each(function(){var msgObj=$(this);var rContent=msgObj.html();var regx=/(\[[\u4e00-\u9fa5]*\w*\]){1}/g;var rs=rContent.match(regx);if(rs){for(i=0;i<rs.length;i++){for(n=0;n<em.length;n++){if(em[n].phrase==rs[i]){var t="<img src='"+imgPath+"emotions/"+em[n].url+"' />";rContent=rContent.replace(rs[i],t);break;}}}}
msgObj.html(rContent);});}});})(jQuery);;(function($){var _util=CS.util,_uiBinder=CS.uiBinder,_dialog=CS.dialog,_mask=CS.mask,_loginPopup=CS.ssoLogin;var _params={},_options={},_objMask=null,_showTabList=['recommend','reward','monthTicket'],_isSubmitingMonthTicket=0,_isSubmitingRecommend=0,_isSubmitingReward=0,_popup_nodes=null,_showPopupCss='pop_show',_selectedTabCss='nav_current';var _tips={'defaultRewardContent':'这本书太棒了！鼓励一下，希望后续更加精彩！'};var _popup_tpl=['<div attr="inner:popup;" class="readerInteractPopup" style="display:none;">','<div class="sakura">','<h1>','<a attr="click:closePopup;" class="close_btn_old close_btn2" href="javascript:"></a>','《<%=bookName%>》读者互动','</h1>','<div attr="inner:tabList;" class="sakura_nav">','<a attr="inner:recommendTab;click:switchTab;" interactiontype="recommend" href="javascript:;" style="display:none;">投推荐票</a>','<a attr="inner:monthTicketTab;click:switchTab;" interactiontype="monthTicket" href="javascript:;" style="display:none;">月  票</a>','<%if is_reward %><a attr="inner:rewardTab;click:switchTab;" interactiontype="reward" href="javascript:;" style="display:none;"><%=rewardDefaultText%></a><%/if%>','</div>','<h2 class="topshadow"></h2>','<div attr="inner:content;" class="pop_cont"></div>','</div>','</div>'].join('');function init(params,options){_params=$.extend({'bookName':'','bid':'','getInteractonContent_ajaxUrl':'','submitReward_ajaxUrl':'','submitRecommend_ajaxUrl':'','submitMonthTicket_ajaxUrl':'','is_reward':''},params||{});_options=$.extend({'showMonthTicket':0,'showRecommend':1,'rewardDefaultText':'打  赏'},options||{});}
function openPopup(type){if(!_util.isLogin()){_loginPopup.showloginPopup();return false;}
if(!_popup_nodes){_popup_nodes=_uiBinder.appendHTML(document.body,_util.sim2tra(_popup_tpl),{'bookName':_params.bookName,'rewardDefaultText':_options.rewardDefaultText,'is_reward':_params.is_reward},{'closePopup':function(){_objMask.close();},'switchTab':_switchPopupTab});_objMask=new _mask(_popup_nodes.popup);}
if(_popup_nodes){var tabName='';for(var i=0,len=_showTabList.length;i<len;i++){tabName=_showTabList[i];if(tabName==='monthTicket'&&!_options.showMonthTicket){continue;}
if(tabName==='recommend'&&!_options.showRecommend){continue;}
$(_popup_nodes[tabName+'Tab']).removeClass(_selectedTabCss).show();}
$("a[interactiontype='"+type+"']",_popup_nodes.tabList).addClass(_selectedTabCss);_objMask.open();_renderInteractContent(type);}
return false;}
function _renderInteractContent(type){if(!_params.getInteractonContent_ajaxUrl||!type){return;}
_util.request({url:_params.getInteractonContent_ajaxUrl,data:{'page':type,'bid':_params.bid},type:'get',dataType:"json",success:function(json){_renderInteractContentCallback(type,json);}});}
function _renderInteractContentCallback(type,tpl){if(!_popup_nodes||!_popup_nodes['content']){return;}
var events={};$(_popup_nodes['content']).html('');switch(type){case'reward':events={'clearCommentDefaultText':_clearRewardCommentDefaultText,'setCommentDefaultText':_setRewardCommentDefaultText,'submitReward':_submitReward};break;case'recommend':events={'submitRecommend':_submitRecommend};break;case'monthTicket':events={'submitMonthTicket':_submitMonthTicket,'switchTab':function(){$(_popup_nodes.rewardTab).trigger('click');}};break;default:break;}
var nodes=_uiBinder.appendHTML(_popup_nodes['content'],tpl,{},events);if(nodes.commentInput){_tips.defaultRewardContent=nodes.commentInput.value;}
var $rewardTips=$("#TextareaTipsArr");if($rewardTips.length>0&&$rewardTips.html().length>0){var rewardCommentList=$.parseJSON($rewardTips.text());if(rewardCommentList){_bindRewardGoldRadioEvent(nodes,rewardCommentList);}}}
function _bindRewardGoldRadioEvent(nodes,rewardCommentList){var $goldRadio=$(nodes.rewardContainer).find('input[type="radio"]');$goldRadio.change(function(){var tips=rewardCommentList[$goldRadio.index(this)];if(tips){nodes.commentInput.value=_util.sim2tra(tips);_tips.defaultRewardContent=tips;}});}
function _switchPopupTab(e,el,nodes){$("a",nodes.tabList).each(function(){$(this).removeClass(_selectedTabCss);});$(el).addClass(_selectedTabCss);_renderInteractContent($(el).attr("interactiontype"));return false;}
function _submitReward(e,el,nodes){if(!_util.isLogin()){$(".close_btn2").click();_loginPopup.showloginPopup();return;}
if(_isSubmitingReward){return false;}
var goldCount=$("input[type='radio']:checked",nodes.rewardContainer).val(),remainedGoldCount=$(el).attr('goldcount');remainedGoldCount=remainedGoldCount?parseInt(remainedGoldCount,10):0;if(!_params.submitReward_ajaxUrl||!_params.bid){_dialog.alert('提交地址或书id未获取到');return false;}
if(!goldCount){_dialog.alert("您还没有设定打赏金额，请选择后再确认打赏!");return false;}
if(goldCount>remainedGoldCount){_dialog.alert("您的账户余额不足，请充值后再进行打赏!");return false;}
var commentLength=$.trim(nodes.commentInput.value).length;if(commentLength<6){_dialog.alert('您的寄语太短了，请输入至少6个字的评论内容！');return false;}else if(commentLength>500){_dialog.alert('您的寄语太长了，请输入至多500个字的评论内容！');return false;}
var commentContent=$(nodes.commentInput).val(),commentHtml=$('<div />').text(commentContent).html();_isSubmitingReward=1;_util.request({url:_params.submitReward_ajaxUrl,data:{'bid':_params.bid,'amount':goldCount,'review':commentHtml},type:'post',dataType:"json",success:function(json){if(json.info){_dialog.alert(json.info);}
if(json.status){$(".close_btn_oldsdo, .close_btn_old").click();}},error:function(){},complete:function(){_isSubmitingReward=0;}});return false;}
function _clearRewardCommentDefaultText(e,el,nodes){if(nodes.commentInput&&$.trim(nodes.commentInput.value)===_util.sim2tra(_tips.defaultRewardContent)){nodes.commentInput.value='';}}
function _setRewardCommentDefaultText(e,el,nodes){if(nodes.commentInput&&$.trim(nodes.commentInput.value).length===0){nodes.commentInput.value=_util.sim2tra(_tips.defaultRewardContent);}}
function _submitRecommend(e,el,nodes){if(!_util.isLogin()){$(".close_btn2").click();_loginPopup.showloginPopup();return;}
if(_isSubmitingRecommend){return false;}
var voteCount=$('input[name=recommend_num]:checked',nodes.recommendContainer).val(),remainedVoteCount=$(el).attr('votecount');remainedVoteCount=remainedVoteCount?parseInt(remainedVoteCount,10):0;if(!_params.submitRecommend_ajaxUrl||!_params.bid){_dialog.alert('提交地址或书id未获取到');return false;}
if(!voteCount){_dialog.alert("您还没有设定投票数量，请选择后再确认投票!");return false;}
if(voteCount>remainedVoteCount){_dialog.alert("剩余推荐票数量不足，请重新设定投票数!");return false;}
_isSubmitingRecommend=1;_util.request({url:_params.submitRecommend_ajaxUrl,data:{'bid':_params.bid,'Votenum':voteCount},type:'post',dataType:"json",success:function(json){if(json.info){_dialog.alert(json.info);}
if(json.status){$(".close_btn_old").click();}},error:function(){},complete:function(){_isSubmitingRecommend=0;}});return false;}
function _submitMonthTicket(e,el,nodes){if(!_util.isLogin()){$(".close_btn2").click();_loginPopup.showloginPopup();return;}
if(_isSubmitingMonthTicket){return false;}
var ticketCount=$('input[name=Monthly_num]:checked',nodes.monthTicketContainer).val(),remainedTicketCount=$(el).attr('ticketcount');remainedTicketCount=remainedTicketCount?parseInt(remainedTicketCount,10):0;if(!_params.submitMonthTicket_ajaxUrl||!_params.bid){_dialog.alert('提交地址或书id未获取到');return false;}
if(ticketCount==="Monthly_num_value"){ticketCount=nodes.ticketCountInput.value;}
if(!ticketCount){_dialog.alert("您还没有设定投票数量，请选择后再确认投票!");return false;}
if(ticketCount>remainedTicketCount){_dialog.alert("剩余月票数量不足，请重新设定投票数!");return false;}
_isSubmitingMonthTicket=1;_util.request({url:_params.submitMonthTicket_ajaxUrl,data:{'bid':_params.bid,'ticketCount':ticketCount},type:'post',dataType:"json",success:function(json){if(json.info){_dialog.alert(json.info);if(json.data){_showQrcode(json.data.id,json.data.url);};}
if(json.status){$(".close_btn_old").click();}},error:function(){},complete:function(){_isSubmitingMonthTicket=0;}});return false;}
function _showQrcode(id,data){var _qrcoderender='canvas';if((navigator.userAgent.indexOf('MSIE')>=0)&&(navigator.userAgent.indexOf('Opera')<0)){_qrcoderender='table';}
$("#"+id).qrcode({render:_qrcoderender,width:110,height:110,text:data});}
_util.initNameSpace("CS");CS.readerInteract={'init':init,'openPopup':openPopup};})(jQuery);;(function($){var _util=CS.util,_dialog=CS.dialog,_mask=CS.mask,_readerInteract=CS.readerInteract,_loginPopup=CS.ssoLogin;var _params={};var _mask_surveyItemPopup=null;function init(bid,isVipNovel,interactionCenterTabIndex,getInteractionCenterAjaxUrl,submitSurveyAjaxUrl,getSurveyResultAjaxUrl){_params.bid=bid||0;_params.isVipNovel=isVipNovel||0;_params.interactionCenterTabIndex=interactionCenterTabIndex||0;_params.getInteractionCenterAjaxUrl=getInteractionCenterAjaxUrl||'';_params.submitSurveyAjaxUrl=submitSurveyAjaxUrl||'';_params.getSurveyResultAjaxUrl=getSurveyResultAjaxUrl||'';_getData();}
function _bindEvent(){$(".tabswish").on('click','a',function(){var tabId=$(this).attr("stab"),$tabBox=$(this).parent("div");$(".swishnev").hide();$tabBox.removeClass('tabstyle').addClass("active");$tabBox.siblings('div').removeClass('active').addClass("tabstyle");$("#"+tabId).show();return false;});$("#recommendBtnpup").on("click",function(){_readerInteract.openPopup('recommend');return false;});$("#rewordBtnpup").on("click",function(){_readerInteract.openPopup('reward');return false;});$("#monthTictPopupBtn").on("click",function(){if(_params.isVipNovel==0){_dialog.alert('本书尚未开通VIP，暂时无法获得月票!');return false;}
_readerInteract.openPopup('monthTicket');return false;});$("#surveyjoinBtn").on('click',function(){var surveyId=$("input[name='surveyId']").val(),selectedSurveyItemId=$("input[name='survote']:checked").val();_submitSurvey(surveyId,selectedSurveyItemId);return false;});$("#surveyresultBtn").on("click",function(){var surveyId=$("input[name='surveyId']").val();_showSurveyResult(surveyId);return false;});}
function _bindSurveyResultPopupEvent(){$("#surveyitempobup .close2").on("click",function(){if(_mask_surveyItemPopup){_mask_surveyItemPopup.close();}});}
function _getData(){_util.request({url:_params.getInteractionCenterAjaxUrl,data:{bid:_params.bid,tab:_params.interactionCenterTabIndex},type:'get',dataType:"json",success:function(json){if(json&&'content'in json){$("#interactcenter").html(json.content).show();_bindEvent();}}});}
function _submitSurvey(surveyId,selectedSurveyItemId){if(!selectedSurveyItemId){_dialog.alert("选择不能为空");return;}
_util.request({url:_params.submitSurveyAjaxUrl,data:{'bid':_params.bid,'sid':surveyId,'itemId':selectedSurveyItemId},type:"post",dataType:"json",success:function(json){if(!json){return;}
if(json.info){_dialog.alert(json.info);}
if(json.code===-1){_loginPopup.showloginPopup();}}});}
function _showSurveyResult(surveyId){_util.request({url:_params.getSurveyResultAjaxUrl,data:{'sid':surveyId},type:"get",dataType:"json",success:function(json){if(!json){return;}
$("#surveyitempobup").html(json);if(!_mask_surveyItemPopup){_mask_surveyItemPopup=new _mask($("#surveyitempobup"));}
_mask_surveyItemPopup.open();_bindSurveyResultPopupEvent();}});}
_util.initNameSpace("CS.page");CS.page.interactionCenter={"init":init};})(jQuery);;(function($){var _util=CS.util,_dialog=CS.dialog,_loginPopup=CS.ssoLogin;var _params={};var _commentContent_maxLen=5000,_isSubmittingComment=0,_defaultCommentTitle='请输入标题';function init(bid,novel_pic,verifyImgUrl,faceImgPath,getCommentListAjaxUrl,up_ajaxUrl,applyHelper_ajaxUrl,submitComment_ajaxUrl){_params.bid=bid||0;_params.novel_pic=novel_pic||'';_params.verifyImgUrl=verifyImgUrl||'';_params.faceImgPath=faceImgPath||'';_params.getCommentListAjaxUrl=getCommentListAjaxUrl||'';_params.up_ajaxUrl=up_ajaxUrl||'';_params.applyHelper_ajaxUrl=applyHelper_ajaxUrl||'';_params.submitComment_ajaxUrl=submitComment_ajaxUrl||'';_getCommentList();}
function _getCommentList(){_util.request({url:_params.getCommentListAjaxUrl,data:{'bid':_params.bid},type:'get',dataType:"json",success:function(json){if(json&&'data'in json){if(json.data.html){$('#intro_comments').html(json.data.html);_bindEvent();}
if(json.data.commentNum){$('#novelInfo_commentCount').text(json.data.commentNum);}}}});}
function _bindEvent(){var $verifyCodeInput=$("#verifyInput");if($verifyCodeInput.length>0){setTimeout(_fleshVerify,1000);$verifyCodeInput.focus(function(){if($(this).val().length===0){_fleshVerify();}});$('#verifyImg').on('click',_fleshVerify);}
$('#commentTitle').on('focus',_setCommentTitleFocus);$('#commentTitle').on('blur',_setCommentTitleBlur);$('#commentContent').keyup(_commentContentInputHandler);$('#submitCommentBtn').on('click',_submitComment);$('#hotCommentTab, #newCommentTab').on('click',_switchCommentList);$('#hotCommentList .nsupport, #newCommentList .nsupport').on('click',_submitUp);$('.applyhelper').on('click',_applyHelper);$('#hotCommentList a[weibotype], #newCommentList a[weibotype]').on('click',function(){return _weiboShare($(this).attr('weibotype'),$(this).parent().siblings('.nev').text());});$("#message_face").jqfaceedit({txtAreaObj:$("#commentContent"),containerObj:$('.leftbtn'),textareaid:"commentContent",top:5,left:-45,faceImgPath:_params.faceImgPath});$("#show_face").click(function(){$('.show_e').html($('#commentContent').val());$('.show_e').emotionsToHtml();});}
function _switchCommentList(){$('#hotCommentTabBox, #newCommentTabBox').removeClass('choice');$(this.parentNode).addClass('choice');$('#hotCommentList, #newCommentList').hide();$('#'+$(this).attr('commentlistid')).show();return false;}
function _fleshVerify(){$('#verifyImg').attr('src',_params.verifyImgUrl+"?rnd="+new Date().getTime());return false;}
function _setCommentTitleFocus(){if(this&&this.value===_util.sim2tra(_defaultCommentTitle)){this.style.color="black";this.value='';}}
function _setCommentTitleBlur(){if(this&&$.trim(this.value)===''){this.style.color="gray";this.value=_util.sim2tra(_defaultCommentTitle);}}
function _commentContentInputHandler(){var el=$(this),inputVal=el.val();if(inputVal.length>_commentContent_maxLen){el.val(inputVal.substring(0,_commentContent_maxLen));}
$('#leftWord').html(_commentContent_maxLen-el.val().length);}
function _submitUp(){var cid=$(this).attr('idx'),upBtn=this;_util.request({url:_params.up_ajaxUrl,data:{'cid':cid},type:'get',dataType:"json",success:function(json){if(json.status){var upCountObj=$("num",upBtn),upCount=parseInt(upCountObj.html(),10)+1;upCountObj.html(upCount);}}});}
function _applyHelper(){_dialog.confirm("您确认要申请成为本书副版主？",function(){_util.request({url:_params.applyHelper_ajaxUrl,data:{'bid':_params.bid},type:'get',dataType:"json",success:function(json){if(json.info){_dialog.alert(json.info);}
if(json.code===1001){if(json.data&&json.data.url){window.location=json.data.url;}}else if(json.code===-1){_loginPopup.showloginPopup();}}});});return false;}
function _submitComment(){var title=$.trim($('#commentTitle').val()),text=$.trim($('#commentContent').val()),$verifyCodeInput=$('#verifyInput'),cmtverify=$verifyCodeInput.length>0?$verifyCodeInput.val():'0';if(!_util.isLogin()){_loginPopup.showloginPopup();return false;}
if(title.length===0||title===_util.sim2tra(_defaultCommentTitle)){_dialog.alert('请输入评论标题');$('#commentTitle').focus();return false;}
if(text.length===0){_dialog.alert('请输入评论内容');$('#commentContent').focus();return false;}
if($verifyCodeInput.length>0&&cmtverify.length!=5){_dialog.alert('验证码不正确!');$verifyCodeInput.val("").focus();return false;}
if(_isSubmittingComment){return;}
_isSubmittingComment=1;_util.request({url:_params.submitComment_ajaxUrl,data:{'bid':_params.bid,'title':title,'text':text,'verify':cmtverify},type:'post',dataType:"json",success:function(json){if(json.status){$('#commentTitle').val('');$('#commentContent').val('');_dialog.alert(json.info,function(){_getCommentList();});}else if(json.info){_dialog.alert(json.info);}},complete:function(){_isSubmittingComment=0;}});return false;}
function _weiboShare(weiboType,title){var weiboShareUrl='';if(weiboType=='sina'){weiboShareUrl='http://service.weibo.com/share/share.php?';}else if(weiboType=='qq'){weiboShareUrl='http://share.v.t.qq.com/index.php?c=share&a=index&';}
var param={url:window.location.href,title:title,pic:_params.novel_pic,rnd:new Date().valueOf()};var arr_param=[];for(var p in param){arr_param.push(p+'='+encodeURIComponent(param[p]||''));}
window.parent.location.href=weiboShareUrl+arr_param.join('&');return false;}
_util.initNameSpace("CS.page.intro");CS.page.intro.comment={"init":init};})(jQuery);;(function($){var _util=CS.util,_dialog=CS.dialog;var _params={};var _isCheckFeed=0,_isGetNovelTree=0;function init(bid,getTreeAjaxUrl,feedTreeAjaxUrl,checkUserFeedToolAjaxUrl){_params.bid=bid||'0';_params.getTreeAjaxUrl=getTreeAjaxUrl||'';_params.feedTreeAjaxUrl=feedTreeAjaxUrl||'';_params.checkUserFeedToolAjaxUrl=checkUserFeedToolAjaxUrl||'';_bindEvent();}
function _bindEvent(){var $treeDetailBox=$("#noveltreedetail");$("#novelTreemin").on('click',function(){_getNovelTree();$treeDetailBox.show();});}
function _bindTreeEvent(){var $growRecord=$('#growRecord');$('#dynamicBtn').on('click',function(){if($growRecord.is(':hidden')){$(this).text('成长树动态 -');$growRecord.slideDown(200);}else{$(this).text('成长树动态 +');$growRecord.slideUp(200);}});$("#waterfeedway").hover(function(){$(this).removeClass('water').addClass('watering');},function(){$(this).removeClass('watering').addClass('water');});$("#fertifeedway").hover(function(){$(this).removeClass('fertilize').addClass('fertilization');},function(){$(this).removeClass('fertilization').addClass('fertilize');});$("#treeClose").on('click',function(){$("#noveltreedetail").hide();return false;});$("#treeProp a").on('click',function(e){var type=$(this).attr("type");_checkFeed(type);return false;});}
function _checkFeed(type){if(type==1){$("#waterfeedway").removeClass('water').addClass('watering');}else{$("#fertifeedway").removeClass('fertilize').addClass('fertilization');}
if(_isCheckFeed===1){return;}
_isCheckFeed=1;_util.request({url:_params.checkUserFeedToolAjaxUrl,data:{'bid':_params.bid,'type':type},type:'post',dataType:"json",success:function(json){if(!json){return;}
if(json.status){_dialog.confirm(json.info,function(){_useFeed(type);});}else if(json.info){_dialog.alert(json.info);}},error:function(){_dialog.alert('网络异常，请稍候再试');},complete:function(){_isCheckFeed=0;}});}
function _useFeed(type){_util.request({url:_params.feedTreeAjaxUrl,data:{'bid':_params.bid,'type':type},type:'post',dataType:"json",success:function(json){if(!json){return;}
if(json.info){_dialog.alert(json.info);}
if(json.status){_getNovelTree();}},error:function(){_dialog.alert('网络异常，请稍候再试');}});}
function _getNovelTree(){if(_isGetNovelTree===1){return;}
_isGetNovelTree=1;_util.request({url:_params.getTreeAjaxUrl,data:{'bid':_params.bid,'t':Math.random()},type:'post',dataType:"json",success:function(json){$("#noveltreedetail").html(json.data.content);if(json.data.Grade>0){$("#novelTreemin a").addClass('level'+json.data.Grade);}
_bindTreeEvent();},error:function(){_dialog.alert('网络异常，请稍候再试');},complete:function(){_isGetNovelTree=0;}});}
_util.initNameSpace("CS.page.intro.tree");CS.page.intro.tree={"init":init};})(jQuery);;(function($){var _util=CS.util,_mask=CS.mask,_dialog=CS.dialog,_loginPopup=CS.ssoLogin;var _params={},_maskByVotePopup=null;function init(bid,authorId,getVoteNumAjaxUrl,votePopupUrl){_params.bid=bid||0;_params.authorId=authorId||0;_params.getVoteNumAjaxUrl=getVoteNumAjaxUrl||'';_params.votePopupUrl=votePopupUrl||'';if($('#goodOriginalBox').length>0){_getVoteNum();}
_bindEvent();}
function _bindEvent(){$('#goodOriginalOpenVotePopupBtn').on('click',function(){_openVotePopup();return false;});}
function _getVoteNum(){_util.request({type:"GET",url:_params.getVoteNumAjaxUrl,dataType:"jsonp",data:{'BID':_params.bid,'authorId':_params.authorId},jsonp:"callback",jsonpCallback:"votenumweb",success:function(json){if(!json){return;}
if(json.status){$('#goodOriginalAuthorVoteNum').text(json.authorIdVote);$('#goodOriginalBookVoteNum').text(json.BIDVote);}},error:function(){}});}
function _openVotePopup(){if(!_util.isLogin()){_loginPopup.showloginPopup();return;}
var $votePopup=$('#goodOriginalVotePopup');if(!_maskByVotePopup){_maskByVotePopup=new _mask($votePopup);$votePopup.find('.closeBtn').on('click',function(){if(_maskByVotePopup){_maskByVotePopup.close();}
return false;});}
if(_maskByVotePopup){$votePopup.find('iframe').attr('src',_params.votePopupUrl+'?BID='+_params.bid+'&authorId='+_params.authorId+'&rnd='+new Date().getTime());_maskByVotePopup.open();}}
_util.initNameSpace("CS.activity");CS.activity.goodOriginal={'init':init};})(jQuery);;(function($){var _util=CS.util,_dialog=CS.dialog,_loginPopup=CS.ssoLogin,_bookshelf=CS.bookshelf,_readerInteract=CS.readerInteract;var _params={};function init(bid,isEpubNovel,getPersonalAjaxUrl){_params.bid=bid||'0';_params.isEpubNovel=isEpubNovel||0;_params.getPersonalAjaxUrl=getPersonalAjaxUrl;_getUserInfo();_bindEvent();_initEpubNovelBtn();}
function _bindEvent(){var $bigQrBox=$('#qrBox'),$bigQrImg=$bigQrBox.find('img');$('#qrImg').add($bigQrBox).hover(function(){$bigQrImg.show();},function(){$bigQrImg.hide();});$('#openMonthPopupBtn').on('click',function(){return _readerInteract.openPopup('monthTicket');});var tabList=[{'$tabBox':$('#authorWeixinTabBox'),'tabTag':'a','$contentItems':$('#authorWeixinContent, #authorSayContent')},{'$tabBox':$('#authorBookTabList'),'tabTag':'a','$contentItems':$('#theAuthorBest, #theAuthorOther')},{'$tabBox':$('#bookRecommendTabBox'),'tabTag':'a','$contentItems':$('#theThisWeek, #theLastWeek')}];$.each(tabList,function(index,item){item.$tabBox.on('click',item.tabTag,function(){var tabIndex=item.$tabBox.find(item.tabTag).index(this);$(this).parent().addClass('choice').siblings().removeClass('choice');item.$contentItems.hide();item.$contentItems.eq(tabIndex).show();return false;});});}
function _getUserInfo(){_util.request({url:_params.getPersonalAjaxUrl,data:{bid:_params.bid,},type:'get',dataType:"json",success:function(json){if(json&&json.status){_getUserInfoCallback(json.data);}}});}
function _getUserInfoCallback(data){if(!data){return;}
var $openRewardPopupBtn=$('#openRewardPopupBtn'),$openRecommendPopupBtn=$('#openRecommendPopupBtn'),$openMonthTicketPopupBtn=$('#openMonthTicketPopupBtn'),$addToBookshelfBtn=$("#addtobookshelf");if(data.uid>0){$openRewardPopupBtn.on('click',function(){return _readerInteract.openPopup('reward');});$openRecommendPopupBtn.on('click',function(){return _readerInteract.openPopup('recommend');});$openMonthTicketPopupBtn.on('click',function(){return _readerInteract.openPopup('monthTicket');});if(data.isFav){$addToBookshelfBtn.removeClass("but01").addClass('but05').text("已加入");}else{$addToBookshelfBtn.on('click',function(){_bookshelf.addToBookshelf(_params.bid,{'successCallback':function(json){if(json.status){$addToBookshelfBtn.unbind('click');$addToBookshelfBtn.removeClass("but01").addClass('but05').text("已加入");if(json.info){if(json.code===0){_dialog.confirm(json.info,function(){if($('#openAutoTake').prop('checked')){_bookshelf._setAutoBuy(bid);}});}else{_dialog.alert(json.info);}}}else{if(json.info){_dialog.alert(json.info);}}}});});}}else{$openRewardPopupBtn.add($openRecommendPopupBtn).add($addToBookshelfBtn).on("click",function(){_loginPopup.showloginPopup();});}
if(data.readUrl){$("#readNow").text("继续阅读").attr("href",data.readUrl);}
if(data.discountTime){var $discountTag=$('#discountTag');if(data.discountType==='discount'){$discountTag.attr('class','discount');}
$discountTag.show();$('#discountTime').text(data.discountTime).show();}}
function _initEpubNovelBtn(){if(_params.isEpubNovel===1){$('#readNow').on('click',function(){_dialog.open({"content":'本作品为epub精排版格式，为了给您带来更完美的阅读体验，请通过QQ阅读客户端浏览。',"button":[{"value":"下载客户端","focus":true,"callback":function(){window.open('http://book.qq.com/act/reader/index.html');}},{"value":"取消"}]});return false;});}}
_util.initNameSpace("CS.page.intro");CS.page.intro.main={"init":init};})(jQuery);